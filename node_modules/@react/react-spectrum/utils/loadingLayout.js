"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = loadingLayout;

var _collectionView = require("@react/collection-view");

/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
* Copyright 2019 Adobe
* All Rights Reserved.
*
* NOTICE: All information contained herein is, and remains
* the property of Adobe and its suppliers, if any. The intellectual
* and technical concepts contained herein are proprietary to Adobe
* and its suppliers and are protected by all applicable intellectual
* property laws, including trade secret and copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe.
**************************************************************************/

/*
 * Adds support for a loading spinner and empty views to a collection-view layout
 */
function loadingLayout(layout) {
  var getLayoutInfo = layout.getLayoutInfo,
      getVisibleLayoutInfos = layout.getVisibleLayoutInfos,
      validate = layout.validate,
      getContentSize = layout.getContentSize;
  var emptyView = null;
  var loadingIndicator = null;

  layout.getLayoutInfo = function (type, section, index) {
    if (type === 'empty-view') {
      return emptyView;
    }

    if (type === 'loading-indicator') {
      return loadingIndicator;
    }

    return getLayoutInfo.call(this, type, section, index);
  };

  layout.getVisibleLayoutInfos = function (rect) {
    var layoutInfos = getVisibleLayoutInfos.call(this, rect);

    if (emptyView) {
      layoutInfos.push(emptyView);
    }

    if (loadingIndicator) {
      layoutInfos.push(loadingIndicator);
    }

    return layoutInfos;
  };

  layout.validate = function (invalidationContext) {
    validate.call(this, invalidationContext);
    var count = this.collectionView.getSectionLength(0);
    var isLoading = this.component.isLoading;

    if (isLoading) {
      loadingIndicator = new _collectionView.LayoutInfo('loading-indicator');

      if (count === 0) {
        loadingIndicator.rect = new _collectionView.Rect(0, 0, this.collectionView.size.width, this.collectionView.size.height);
      } else {
        loadingIndicator.rect = new _collectionView.Rect(0, getContentSize.call(this).height, this.collectionView.size.width, 100);
      }
    } else {
      loadingIndicator = null;

      if (count === 0) {
        emptyView = new _collectionView.LayoutInfo('empty-view');
        emptyView.rect = new _collectionView.Rect(0, 0, this.collectionView.size.width, this.collectionView.size.height);
      } else {
        emptyView = null;
      }
    }
  };

  layout.getContentSize = function () {
    var size = getContentSize.call(this);
    var count = this.collectionView.getSectionLength(0);

    if (loadingIndicator && count > 0) {
      size.height += loadingIndicator.rect.height;
    }

    return size;
  };

  return layout;
}