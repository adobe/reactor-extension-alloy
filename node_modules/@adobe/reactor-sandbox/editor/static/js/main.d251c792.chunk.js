(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{26:function(e,t,n){},36:function(e,t,n){e.exports=n(67)},41:function(e,t,n){},54:function(e,t,n){},55:function(e,t,n){},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){},63:function(e,t,n){},64:function(e,t,n){},65:function(e,t,n){},66:function(e,t,n){},67:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(21),s=n.n(o),i=(n(41),n(6)),l=n(5),c=n(8),u=n(7),m=n(9),d=n(2),p=n(3),g=n(16),h=n(23),f=n(33),E=n(1),v={state:null,reducers:{setCurrentRule:function(e,t){return t},saveComponent:function(e,t){return e.updateIn([t.type,t.id],function(e){return t.component})},addComponent:function(e,t){return e.update(t.type,function(n){return(e.get(t.type)||Object(E.List)()).push(t.component)})}}},b={extensionName:null,state:Object(E.Map)({dataElements:[],rules:[],extensions:[]}),get:function(){return this.state},loadStateFor:function(e){this.extensionName=e;var t=JSON.parse(localStorage.getItem("sandbox-rule-editor-container-".concat(e)));t&&(this.state=Object(E.fromJS)(t))},update:function(e,t){t="extensions"===e||"dataElements"===e?t.reduce(function(e,t){return e.set(t.get("name"),t.delete("name"))},Object(E.Map)()):t.toJS(),this.state=this.state.set(e,t),this.extensionName&&localStorage.setItem("sandbox-rule-editor-container-".concat(this.extensionName),JSON.stringify(this.state.toJS()))}},y={state:Object(E.List)(),reducers:{setRules:function(e,t){return b.update("rules",t),t},addRule:function(e,t){var n=e.push(t.rule.set("id","RL".concat(Date.now())));return b.update("rules",n),n},saveRule:function(e,t){var n=e.update(t.id,function(e){return t.rule.set("id","RL".concat(Date.now()))});return b.update("rules",n),n},deleteRule:function(e,t){var n=e.delete(t);return b.update("rules",n),n}}},C=n(15),S={state:Object(E.List)(),reducers:{setDataElements:function(e,t){var n=t.entrySeq().map(function(e){var t=Object(C.a)(e,2),n=t[0];return t[1].merge({name:n})}).toList();return b.update("dataElements",n),n},addDataElement:function(e,t){var n=e.push(t.dataElement);return b.update("dataElements",n),n},saveDataElement:function(e,t){var n=e.update(t.id,function(e){return t.dataElement});return b.update("dataElements",n),n},deleteDataElement:function(e,t){var n=e.delete(t);return b.update("dataElements",n),n}}},k={state:Object(E.Map)(),reducers:{setPropertySettings:function(e,t){return b.update("property",Object(E.Map)().set("settings",t)),t}}},O={state:Object(E.Map)(),reducers:{setOtherSettings:function(e,t){return b.update("otherSettings",t),t}}},x={state:Object(E.List)(),reducers:{setExtensionConfigurations:function(e,t){var n=t.entrySeq().map(function(e){var t=Object(C.a)(e,2),n=t[0];return t[1].merge({name:n})}).toList();return b.update("extensions",n),n},addExtensionConfiguration:function(e,t){var n=e.push(t.extensionConfiguration);return b.update("extensions",n),n},saveExtensionConfiguration:function(e,t){var n=e.update(t.id,function(e){return t.extensionConfiguration});return b.update("extensions",n),n},deleteExtensionConfiguration:function(e,t){var n=e.delete(t);return b.update("extensions",n),n}}},j=n(17),N=n.n(j),D=n(24),I={host:"http://localhost",port:3e3},L={state:Object(E.Map)(),reducers:{setContainerDataLoaded:function(e,t){return e.set("containerDataLoaded",t)},setContainerDataReseted:function(e,t){return e.set("containerDataReseted",t)},setInitialized:function(e,t){return e.set("initialized",t)}},effects:{initialize:function(){var e=Object(D.a)(N.a.mark(function e(t,n){var a,r,o,s=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(I.host,":").concat(I.port,"/editor-registry.js"));case 2:if(!(a=e.sent).ok){e.next=12;break}return e.next=6,a.json();case 6:r=e.sent,o=Object(E.fromJS)(r),P.registry.setRegistry(o.delete("currentExtensionName")),b.loadStateFor(o.get("currentExtensionName")),this.pushDataDown(b.get()),setTimeout(function(){s.setInitialized(!0)},0);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),loadContainerData:function(){var e=Object(D.a)(N.a.mark(function e(t,n){var a,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(I.host,":").concat(I.port,"/editor-container.js"));case 2:if(!(a=e.sent).ok){e.next=11;break}return e.next=6,a.json();case 6:r=e.sent,this.pushDataDown(Object(E.Map)(r)),this.setContainerDataLoaded("success"),e.next=12;break;case 11:this.setContainerDataLoaded("failed");case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),clearContainerData:function(e,t){this.pushDataDown(Object(E.Map)({extensions:[],rules:[],dataElements:[],property:{settings:{}}})),this.setContainerDataReseted("success")},pushDataDown:function(e,t){P.extensionConfigurations.setExtensionConfigurations(Object(E.fromJS)(e.get("extensions"))),P.rules.setRules(Object(E.fromJS)(e.get("rules"))),P.dataElements.setDataElements(Object(E.fromJS)(e.get("dataElements"))),P.propertySettings.setPropertySettings(Object(E.fromJS)(e.getIn(["property","settings"])||{domains:["example.com"]})),P.otherSettings.setOtherSettings(Object(E.fromJS)(e.get("otherSettings")||{company:{orgId:"ABCDEFGHIJKLMNOPQRSTUVWX@AdobeOrg"},tokens:{imsAccess:"fake-ims-access-token"}}))},save:function(){var e=Object(D.a)(N.a.mark(function e(){var t,n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=b.get(),n=t.setIn(["company","orgId"],t.get("otherSettings").company.orgId).delete("otherSettings"),e.next=4,fetch("".concat(I.host,":").concat(I.port,"/editor-container.js"),{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 4:e.sent.ok?window.location="".concat(I.host,":").concat(I.port,"/libSandbox.html"):alert("Something went bad!");case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}},R={state:Object(E.Map)(),reducers:{openCodeEditorModal:function(e,t){return e.merge(Object(E.fromJS)({codeEditorModal:{open:!0,code:t.code,onSave:t.onSave,onClose:t.onClose}}))},closeCodeEditorModal:function(e,t){return e.delete("codeEditorModal")},openDataElementSelectorModal:function(e,t){return e.merge(Object(E.fromJS)({dataElementSelectorModal:{open:!0,onSave:t.onSave,onClose:t.onClose}}))},closeDataElementSelectorModal:function(e,t){return e.delete("dataElementSelectorModal")}}},M=Object(f.init)({models:{brain:L,rules:y,dataElements:S,extensionConfigurations:x,registry:{state:null,reducers:{setRegistry:function(e,t){return t}}},currentIframe:{state:{},reducers:{setCurrentIframe:function(e,t){return t}}},currentRule:v,propertySettings:k,otherSettings:O,modals:R}}),w=M,P=M.dispatch,_=n(34),F=(n(54),Object(g.k)(Object(d.b)(function(){return{}},function(e){var t=e.brain.save;return{save:function(){return t()}}})(function(e){var t=e.match,n=e.save;return r.a.createElement("div",{className:"main-menu"},r.a.createElement("div",{className:"pure-menu pure-menu-horizontal"},r.a.createElement(p.Link,{className:"pure-menu-heading pure-menu-link",to:"/"},"Editor"),r.a.createElement("ul",{className:"pure-menu-list"},r.a.createElement("li",{className:"pure-menu-item"},r.a.createElement(p.Link,{to:"/extension_configurations",className:"pure-menu-link ".concat("/extension_configurations"===t.path?"menu-selected":"")},"Extension Configurations")),r.a.createElement("li",{className:"pure-menu-item"},r.a.createElement(p.Link,{to:"/data_elements",className:"pure-menu-link ".concat("/data_elements"===t.path?"menu-selected":"")},"Data Elements")),r.a.createElement("li",{className:"pure-menu-item"},r.a.createElement(p.Link,{to:"/rules",className:"pure-menu-link ".concat(t.path.includes("/rules")?"menu-selected":"")},"Rules")),r.a.createElement("li",{className:"pure-menu-item"},r.a.createElement(p.Link,{to:"/property_settings",className:"pure-menu-link ".concat("/property_settings"===t.path?"menu-selected":"")},"Property Settings")),r.a.createElement("li",{className:"pure-menu-item"},r.a.createElement(p.Link,{to:"/settings",className:"pure-menu-link ".concat("/settings"===t.path?"menu-selected":"")},"Settings")),function(e){return-1!==["/","/extension_configurations","/data_elements","/rules","/property_settings"].indexOf(e.path)}(t)?r.a.createElement("li",{className:"pure-menu-item"},r.a.createElement("button",{type:"button",className:"pure-menu-link",onClick:n},"Save and Exit")):null)))}))),T=(n(55),function(e){var t=e.show,n=e.title,a=e.children,o=e.onSave,s=e.onClose;return t?r.a.createElement("div",{className:"backdrop"},r.a.createElement("div",{className:"modal"},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"title"},n),r.a.createElement("button",{type:"button",onClick:s,title:"Delete",className:"icono-cross"})),a,r.a.createElement("div",{className:"footer"},r.a.createElement("button",{type:"button",className:"pure-button-primary pure-button",onClick:o},"Save"),"\xa0",r.a.createElement("button",{type:"button",className:"pure-button",onClick:s},"Cancel")))):null}),z=(n(56),function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleOnSave=function(){var e=n.state.codeEditorModal,t=n.props.closeCodeEditorModal;e.get("onSave")(e.get("code")),t()},n.handleOnClose=function(){var e=n.state.codeEditorModal,t=n.props.closeCodeEditorModal;e.get("onClose")(),t()},n.handleCodeChange=function(e){var t=n.state.codeEditorModal;n.setState({codeEditorModal:t.set("code",e.target.value)})},n.state={codeEditorModal:Object(E.Map)(),prevModalSize:e.modals.size},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.codeEditorModal;return e?r.a.createElement("div",{className:"modal-code-editor"},r.a.createElement(T,{title:"Code Editor",show:e.get("open"),onSave:this.handleOnSave,onClose:this.handleOnClose},r.a.createElement("div",{className:"pure-form"},r.a.createElement("textarea",{value:e.get("code"),onChange:this.handleCodeChange})))):null}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.modals.size!==t.prevModalSize?{prevModalSize:e.modals.size,codeEditorModal:e.modals.getIn(["codeEditorModal"])}:null}}]),t}(a.Component)),J=Object(g.k)(Object(d.b)(function(e){return{modals:e.modals}},function(e){var t=e.modals.closeCodeEditorModal;return{closeCodeEditorModal:function(e){return t(e)}}})(z)),V=(n(57),function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleOnSave=function(){var e=n.state.dataElementSelectorModal,t=n.props.closeDataElementSelectorModal,a="";e.get("dataElement")&&(a="%".concat(e.get("dataElement"),"%")),e.get("onSave")(a),t()},n.handleOnClose=function(){var e=n.state.dataElementSelectorModal,t=n.props.closeDataElementSelectorModal;e.get("onClose")(),t()},n.handleDataElementChange=function(e){var t=n.state.dataElementSelectorModal;n.setState({dataElementSelectorModal:t.set("dataElement",e.target.value)})},n.state={dataElementSelectorModal:Object(E.Map)(),prevModalSize:e.modals.size},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"dataElementList",value:function(){return(this.props.dataElements||Object(E.List)()).valueSeq().map(function(e){return r.a.createElement("option",{value:e.get("name"),key:"extensionConfiguration".concat(e.get("name"))},e.get("name"))})}},{key:"render",value:function(){var e=this.state.dataElementSelectorModal;return e?r.a.createElement("div",{className:"modal-data-element-selector pure-form"},r.a.createElement(T,{title:"Data Element Selector",show:e.get("open"),onSave:this.handleOnSave,onClose:this.handleOnClose},r.a.createElement("select",{value:e.get("dataElement"),onChange:this.handleDataElementChange},r.a.createElement("option",null,"Please select..."),this.dataElementList()))):null}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.modals.size!==t.prevModalSize?{prevModalSize:e.modals.size,dataElementSelectorModal:e.modals.getIn(["dataElementSelectorModal"])}:null}}]),t}(a.Component)),A=Object(g.k)(Object(d.b)(function(e){return{modals:e.modals,dataElements:e.dataElements}},function(e){var t=e.modals.closeDataElementSelectorModal;return{closeDataElementSelectorModal:function(e){return t(e)}}})(V)),q=Object(g.k)(Object(d.b)(function(e){return{brain:e.brain}},function(){return{}})(function(e){var t=e.component,n=e.brain,a=Object(_.a)(e,["component","brain"]);return r.a.createElement(g.d,Object.assign({},a,{render:function(e){return n.get("initialized")?r.a.createElement("div",{className:"view-container"},r.a.createElement(J,null),r.a.createElement(A,null),r.a.createElement(F,null),r.a.createElement(t,e)):r.a.createElement("div",{className:"big-text"},"Fetching data...")}}))})),W=(n(58),function(){return r.a.createElement("div",null,r.a.createElement("div",{className:"main-container"},r.a.createElement("div",{className:"big-text"},"Welcome to the sandbox editor! "),r.a.createElement("p",null,"Start using it by selecting any option from the menu.")))}),U=(n(59),function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleOrgIdChange=function(e){var t=n.state.otherSettings;n.setState({otherSettings:t.setIn(["company","orgId"],e.target.value)})},n.handleImsChange=function(e){var t=n.state.otherSettings;n.setState({otherSettings:t.setIn(["tokens","imsAccess"],e.target.value)})},n.handleSave=function(){var e=n.props,t=e.history,a=e.setOtherSettings,r=n.state.otherSettings;return!!n.isValid()&&(a(r),t.push("/"),!0)},n.state={otherSettings:e.otherSettings,errors:{}},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"isValid",value:function(){var e={},t=this.state.otherSettings;return t.getIn(["company","orgId"])||(e.orgId=!0),t.getIn(["tokens","imsAccess"])||(e.imsAccess=!0),this.setState({errors:e}),0===Object.keys(e).length}},{key:"render",value:function(){var e=this.state,t=e.errors,n=e.otherSettings;return r.a.createElement("div",{className:"other-settings-container"},r.a.createElement("form",{className:"pure-form pure-form-aligned"},r.a.createElement("fieldset",null,r.a.createElement("legend",null,"Company Settings"),r.a.createElement("div",{className:"pure-control-group"},r.a.createElement("label",{htmlFor:"orgId"},"Organization ID"),r.a.createElement("input",{className:"pure-input-2-3 ".concat(t.orgId?"border-error":""),id:"orgId",type:"text",value:n.getIn(["company","orgId"])||"",onChange:this.handleOrgIdChange}))),r.a.createElement("fieldset",null,r.a.createElement("legend",null,"Tokens"),r.a.createElement("div",{className:"pure-control-group"},r.a.createElement("label",{htmlFor:"imsAccess"},"IMS Token"),r.a.createElement("input",{className:"pure-input-2-3 ".concat(t.imsAccess?"border-error":""),id:"imsAccess",type:"text",value:n.getIn(["tokens","imsAccess"])||"",onChange:this.handleImsChange})),r.a.createElement("div",{className:"pure-controls"},r.a.createElement("button",{type:"button",className:"pure-button pure-button-primary",onClick:this.handleSave},"Save")))))}}]),t}(a.Component)),G=Object(g.k)(Object(d.b)(function(e){return{otherSettings:e.otherSettings}},function(e){var t=e.otherSettings.setOtherSettings;return{setOtherSettings:function(e){return t(e)}}})(U)),H=Object(g.k)(Object(d.b)(function(e){return{brain:e.brain,orgId:e.otherSettings.getIn(["company","orgId"]),imsAccess:e.otherSettings.getIn(["tokens","imsAccess"])}},function(e){var t=e.brain,n=t.loadContainerData,a=t.clearContainerData;return{loadContainerData:function(){return n()},clearContainerData:function(){return a()}}})(function(e){var t=e.brain,n=e.orgId,a=e.imsAccess,o=e.loadContainerData,s=e.clearContainerData;return r.a.createElement("div",null,r.a.createElement(G,{key:"".concat(n).concat(a)}),r.a.createElement("div",{className:"main-container"},r.a.createElement("p",null,"The data used inside this editor is loaded from `localStorage`."),r.a.createElement("p",null,"If you want to overwrite the current data with the one stored inside the"," ",r.a.createElement("strong",null,"`.sandbox/container.js`")," file click on the `Import data` button.",r.a.createElement("button",{type:"button",className:"pure-button pure-button-primary",onClick:o},"Import data"),null!=t.get("containerDataLoaded")?r.a.createElement("span",{className:"status-".concat(t.get("containerDataLoaded"))},r.a.createElement("br",null),"Last import status:"," ",r.a.createElement("strong",null,t.get("containerDataLoaded")),"."):null),r.a.createElement("p",null,"If you want to reset current data click on the `Reset data` button.",r.a.createElement("button",{type:"button",className:"pure-button pure-button-primary",onClick:s},"Reset data"),null!=t.get("containerDataReseted")?r.a.createElement("span",{className:"status-".concat(t.get("containerDataReseted"))},r.a.createElement("br",null),"Last reset status:"," ",r.a.createElement("strong",null,t.get("containerDataReseted")),"."):null)))})),B=(n(60),function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={propertySettings:e.propertySettings.set("domains",e.propertySettings.get("domains").toJS().join(", ")),errors:{}},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"handleDomainsChange",value:function(e){this.setState({propertySettings:this.state.propertySettings.set("domains",e.target.value)})}},{key:"isValid",value:function(){var e={};return this.state.propertySettings.get("domains")||(e.domains=!0),this.setState({errors:e}),0===Object.keys(e).length}},{key:"handleSave",value:function(e){if(!this.isValid())return!1;this.props.setPropertySettings(this.state.propertySettings.set("domains",Object(E.List)(this.state.propertySettings.get("domains").split(",").map(function(e){return e.trim()})))),this.props.history.push("/")}},{key:"render",value:function(){return r.a.createElement("div",{className:"property-settings-container"},r.a.createElement("form",{className:"pure-form pure-form-aligned"},r.a.createElement("fieldset",null,r.a.createElement("legend",null,"Property Settings"),r.a.createElement("div",{className:"pure-control-group"},r.a.createElement("label",{htmlFor:"domainsList"},"Domains List"),r.a.createElement("input",{className:"pure-input-1-3 ".concat(this.state.errors.domains?"border-error":""),id:"domainsList",type:"text",value:this.state.propertySettings.get("domains")||"",onChange:this.handleDomainsChange.bind(this)}),r.a.createElement("span",{className:"pure-form-message-inline"},"Comma separated values are accepted.")),r.a.createElement("div",{className:"pure-controls"},r.a.createElement("button",{className:"pure-button pure-button-primary",onClick:this.handleSave.bind(this)},"Save")))))}}]),t}(a.Component)),K=Object(g.k)(Object(d.b)(function(e){return{propertySettings:e.propertySettings}},function(e){var t=e.propertySettings.setPropertySettings;return{setPropertySettings:function(e){return t(e)}}})(B)),Q=(n(61),function(e){var t=e.items,n=e.nameProperty,a=e.deleteFn,o=e.className,s=e.linkPrefix;return r.a.createElement("div",{className:"list-container ".concat(o)},r.a.createElement("table",{className:"pure-table list-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",{className:"list-item-actions"},"Actions"))),r.a.createElement("tbody",null,t.map(function(e,t){return r.a.createElement("tr",{key:e},r.a.createElement("td",{className:"list-item-name"},e.get(n)),r.a.createElement("td",{className:"list-item-actions"},r.a.createElement(p.Link,{to:"".concat(s,"/").concat(t),className:"pure-button-primary pure-button"},"Edit"),"\xa0",r.a.createElement("button",{type:"button",onClick:a.bind(void 0,t),className:"pure-button"},"Delete")))}),0===t.size?r.a.createElement("tr",null,r.a.createElement("td",{colSpan:"2"},"No items found.")):null)),r.a.createElement(p.Link,{to:"".concat(s,"/new"),className:"pure-button pure-button-primary create-new-button"},"Add"))}),X=Object(g.k)(Object(d.b)(function(e){return{rules:e.rules}},function(e){var t=e.rules.deleteRule;return{deleteRule:function(e){return t(e)}}})(function(e){var t=e.rules,n=e.deleteRule;return r.a.createElement(Q,{items:t,nameProperty:"name",deleteFn:n,linkPrefix:"/rules",className:"rules-list"})})),$=(n(62),n(63),n(64),Object(g.k)(Object(d.b)(function(e){return{registry:e.registry}},function(){return{}})(function(e){var t=e.item,n=e.match,a=e.type,o=e.index,s=e.registry,i=e.handleDeleteClick;return r.a.createElement("div",{className:"rule-component-card",title:t.get("modulePath")},function(e,t,n){var a=n.getIn(["components",t,e.get("modulePath")]);return r.a.createElement("div",null,r.a.createElement("div",{className:"card-display-name",title:a.get("displayName")},a.get("displayName")),r.a.createElement("div",{className:"card-extension-display-name",title:a.get("extensionDisplayName")},a.get("extensionDisplayName")))}(t,a,s),r.a.createElement(p.Link,{to:"/rules/".concat(n.params.rule_id,"/").concat(a,"/").concat(o)},r.a.createElement("div",{title:"Edit",className:"icono-file"})),r.a.createElement("button",{type:"button",onClick:i.bind(void 0,a,o),title:"Delete",className:"icono-cross"}))}))),Y=function(e,t,n){n.push("/rules/".concat(t.params.rule_id,"/").concat(e,"/new"))},Z=Object(g.k)(function(e){var t=e.items,n=e.type,a=e.match,o=e.history,s=e.handleDeleteClick;return r.a.createElement("div",null,r.a.createElement("div",{className:"rule-components-list"},t.map(function(e,t){return r.a.createElement($,{key:e,item:e,type:n,index:t,handleDeleteClick:s})})),r.a.createElement("button",{type:"button",onClick:Y.bind(void 0,n,a,o),className:"add-button pure-button pure-button-primary"},"Add"))}),ee=function(e){var t=e.match.params.rule_id,n=e.rules;return"new"===t||!n||t>=n.size},te=!1,ne=function(e){var t,n=e.match.params.rule_id,a=e.currentRule;return t=e.lastLocation,te||(te=!0,t&&t.pathname.match(/^\/rules\/.*\/(:?events|conditions|actions)\/.*$/))||(a=null),(a&&a.get("id")===n?a:(e.rules||Object(E.List)()).get(n)||Object(E.Map)()).set("id",n)},ae=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleSave=function(){if(!n.isValid())return!1;var e=n.props,t=e.addRule,a=e.saveRule,r=e.match.params.rule_id,o=e.setCurrentRule,s=e.history,i=n.state.rule;return(ee(n.props)?t:a)({id:r,rule:i}),o(null),s.push("/rules"),!0},n.handleNameChange=function(e){var t=n.state.rule,a=n.props.setCurrentRule,r=t.set("name",e.target.value);a(r),n.setState({rule:r})},n.handleCancelClick=function(){(0,n.props.setCurrentRule)(null)},n.handleDeleteClick=function(e,t){var a=n.props.setCurrentRule,r=n.state.rule.deleteIn([e,t]);a(r),n.setState({rule:r})},n.state={rule:ne(e),errors:{}},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillUnmount",value:function(){te=!1}},{key:"isValid",value:function(){var e={};return this.state.rule.get("name")||(e.name=!0),this.setState({errors:e}),0===Object.keys(e).length}},{key:"render",value:function(){var e=this.state,t=e.rule,n=e.errors;return r.a.createElement("div",{className:"pure-g container"},r.a.createElement("div",{className:"pure-u-1-1"},r.a.createElement("form",{className:"pure-form"},r.a.createElement("fieldset",null,r.a.createElement("legend",null,r.a.createElement("strong",null,ee(this.props)?"Create":"Edit"," Rule")),r.a.createElement("input",{type:"text",className:n.name?"border-error":"",placeholder:"Rule name",value:t.get("name")||"",onChange:this.handleNameChange}))),r.a.createElement("div",{className:"component-group"},r.a.createElement("strong",null,"Events"),r.a.createElement(Z,{handleDeleteClick:this.handleDeleteClick,items:t.get("events")||Object(E.List)(),type:"events"})),r.a.createElement("div",{className:"component-group"},r.a.createElement("strong",null,"Conditions"),r.a.createElement(Z,{handleDeleteClick:this.handleDeleteClick,items:t.get("conditions")||Object(E.List)(),type:"conditions"})),r.a.createElement("div",{className:"component-group"},r.a.createElement("strong",null,"Actions"),r.a.createElement(Z,{handleDeleteClick:this.handleDeleteClick,items:t.get("actions")||Object(E.List)(),type:"actions"})),r.a.createElement("div",{className:"button-container"},r.a.createElement("button",{type:"button",onClick:this.handleSave,className:"pure-button-primary pure-button"},"Save"),"\xa0",r.a.createElement(p.Link,{onClick:this.handleCancelClick,to:"/rules",className:"pure-button"},"Cancel"))))}}]),t}(a.Component),re=Object(g.k)(Object(d.b)(function(e){return{currentRule:e.currentRule,rules:e.rules}},function(e){var t=e.rules,n=t.saveRule,a=t.addRule,r=e.currentRule.setCurrentRule;return{addRule:function(e){return a(e)},saveRule:function(e){return n(e)},setCurrentRule:function(e){return r(e)}}})(Object(h.withLastLocation)(ae))),oe=(n(26),n(35)),se=(n(65),function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.renderIframe()}},{key:"componentDidUpdate",value:function(){this.dom.innerHTML="",this.renderIframe()}},{key:"getUrl",value:function(){var e=this.props,t=e.component,n=e.server;if(!t)return"";var a=n.get("host"),r=n.get("port"),o=t.get("viewPath");return o||(o="noConfigIframe.html"),"".concat(a,":").concat(r,"/").concat(o)}},{key:"renderIframe",value:function(){var e=this.getUrl(),t=this.props,n=t.openCodeEditorModal,a=t.openDataElementSelectorModal,r=t.settings,o=t.otherSettings,s=t.propertySettings,i=t.extensionConfiguration,l=t.setCurrentIframe;if(e){var c={settings:r&&r.toJS(),company:o.get("company").toJS(),propertySettings:s.toJS(),tokens:o.get("tokens").toJS()};i&&(c.extensionSettings=i.get("settings").toJS()),l(Object(oe.a)({url:e,container:this.dom,extensionInitOptions:c,connectionTimeoutDuration:3e4,openCodeEditor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,a){n({code:e.code,onSave:t,onClose:a})}).catch(function(){})},openRegexTester:function(){},openDataElementSelector:function(){return new Promise(function(e,t){a({onSave:e,onClose:t})}).catch(function(){return""})},markAsDirty:function(){}}))}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{ref:function(t){e.dom=t},className:"component-iframe"})}}]),t}(a.Component)),ie=Object(d.b)(function(e){return{propertySettings:e.propertySettings,otherSettings:e.otherSettings}},function(e){var t=e.currentIframe.setCurrentIframe,n=e.modals,a=n.openCodeEditorModal,r=n.openDataElementSelectorModal;return{setCurrentIframe:function(e){return t(e)},openCodeEditorModal:function(e){return a(e)},openDataElementSelectorModal:function(e){return r(e)}}})(se),le=(n(66),function(e){var t=e.message;return r.a.createElement("div",{className:"backdrop backdrop-only pure-u-1-1"},r.a.createElement("div",{className:"lds-ring"},r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null)),t)}),ce=function(e,t,n){return"new"===e||e>=(n.get(t)||Object(E.List)()).size},ue=function(e,t,n){return(e&&e.get("id")===n?e:(t||Object(E.List)()).get(n)||Object(E.Map)()).set("id",n)},me=function(e){var t=e.match.params,n=t.type,a=t.component_id,r=t.rule_id,o=e.rules,s=e.currentRule;return ue(s,o,r).getIn([n,a])||Object(E.Map)({modulePath:"",settings:null})},de=function(e){function t(e){var n;Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleComponentTypeChange=function(e){var t=n.state.component;n.setState({component:t.merge({settings:null,modulePath:e.target.value})})},n.handleOrderChange=function(e){var t=n.state.component,a=e.target.value,r=t.set("order",a);n.setState({component:r})},n.handleSave=function(){if(!n.isValid())return!1;var e=n.state.component,t=n.props,a=t.addComponent,r=t.saveComponent,o=t.match.params,s=o.component_id,i=o.type,l=t.currentIframe,c=t.history,u=n.state.currentRule,m=ce(s,i,u)?a:r;return n.setState({waitingForExtensionResponse:!0}),l.promise.then(function(e){return Promise.all([e.validate(),e.getSettings()])}).then(function(t){var a=Object(C.a)(t,2),r=a[0],o=a[1];r?(m({id:s,type:i,component:e.merge({settings:o})}),c.push(n.backLink())):n.setState({waitingForExtensionResponse:!1})}),!0};var a=ue(e.currentRule,e.rules,e.match.params.rule_id);return n.state={errors:{},waitingForExtensionResponse:!1,component:me(e),currentRule:a},e.setCurrentRule(a),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentList",value:function(){var e=this.props,t=e.match.params.type,n=e.registry,a={},o=[];return(n.getIn(["components",t])||Object(E.List)()).valueSeq().forEach(function(e){a[e.get("extensionDisplayName")]||(a[e.get("extensionDisplayName")]=[]),a[e.get("extensionDisplayName")].push(r.a.createElement("option",{value:"".concat(e.get("extensionName"),"/").concat(e.get("libPath")),key:"optionType".concat(e.get("libPath"))},e.get("displayName")))}),Object.keys(a).forEach(function(e){o.push(r.a.createElement("optgroup",{key:"optGroupExtension".concat(e),label:e},a[e]))}),o}},{key:"isValid",value:function(){var e={};return this.state.component.get("modulePath")||(e.modulePath=!0),this.setState({errors:e}),0===Object.keys(e).length}},{key:"backLink",value:function(){var e=this.props.match.params.rule_id;return"/rules/".concat(e)}},{key:"render",value:function(){var e=this.state,t=e.waitingForExtensionResponse,n=e.component,a=e.errors,o=this.props,s=o.match.params.type,i=o.registry,l=o.extensionConfigurations,c=i.getIn(["components",s,n.get("modulePath")]),u=n.get("modulePath").split("/")[0];return r.a.createElement("div",{className:"pure-g component-edit-container"},t?r.a.createElement(le,{message:"Waiting for the extension response..."}):null,r.a.createElement("div",{className:"pure-u-1-4"},r.a.createElement("div",{className:"component-edit-sidebar"},r.a.createElement("form",{className:"pure-form pure-form-stacked"},r.a.createElement("fieldset",null,r.a.createElement("h4",null,"Component Details"),r.a.createElement("label",{htmlFor:"componentType"},r.a.createElement("span",null,"Type"),r.a.createElement("select",{id:"componentType",className:a.modulePath?"border-error":"",value:n.get("modulePath"),onChange:this.handleComponentTypeChange},r.a.createElement("option",{value:""},"Please select..."),this.componentList())),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"order"},r.a.createElement("span",null,"Order"),r.a.createElement("input",{id:"order",type:"text",value:n.get("order")||"50",onChange:this.handleOrderChange})))),r.a.createElement("div",{className:"button-container"},r.a.createElement("button",{type:"button",className:"pure-button-primary pure-button",onClick:this.handleSave},"Save"),"\xa0",r.a.createElement(p.Link,{to:this.backLink(),className:"pure-button"},"Cancel")))),r.a.createElement("div",{className:"pure-u-3-4"},r.a.createElement(ie,{component:c,extensionConfiguration:l.filter(function(e){return e.get("name")===u}).first(),settings:n.get("settings"),server:i.getIn(["environment","server"])})))}}]),t}(a.Component),pe=Object(g.k)(Object(d.b)(function(e){return{rules:e.rules,currentRule:e.currentRule,currentIframe:e.currentIframe,registry:e.registry,extensionConfigurations:e.extensionConfigurations}},function(e){var t=e.rules.saveRule,n=e.currentRule,a=n.setCurrentRule,r=n.saveComponent,o=n.addComponent;return{saveRule:function(e){return t(e)},setCurrentRule:function(e){return a(e)},saveComponent:function(e){return r(e)},addComponent:function(e){return o(e)}}})(de)),ge=Object(g.k)(Object(d.b)(function(e){return{dataElements:e.dataElements}},function(e){var t=e.dataElements.deleteDataElement;return{deleteDataElement:function(e){return t(e)}}})(function(e){var t=e.dataElements,n=e.deleteDataElement;return r.a.createElement(Q,{items:t,nameProperty:"name",deleteFn:n,linkPrefix:"/data_elements",className:"data-elements-list"})})),he=function(e){var t=e.match.params.data_element_id;return(e.dataElements||Object(E.List)()).get(t)||Object(E.Map)({modulePath:"",settings:null})},fe=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={waitingForExtensionResponse:!1,dataElement:he(e),errors:{}},n}return Object(m.a)(t,e),Object(l.a)(t,null,[{key:"backLink",value:function(){return"/data_elements/"}}]),Object(l.a)(t,[{key:"handleComponentTypeChange",value:function(e){var t=this.state.dataElement;this.setState({dataElement:t.merge({settings:null,modulePath:e.target.value})})}},{key:"handleInputChange",value:function(e,t){var n=this.state.dataElement,a=t.target,r="checkbox"===a.type?a.checked:a.value,o=n.set(e,r);this.setState({dataElement:o})}},{key:"handleSave",value:function(){var e=this;if(!this.isValid())return!1;var t=this.props,n=t.addDataElement,a=t.saveDataElement,r=t.currentIframe,o=t.history,s=t.match.params,i=this.state.dataElement,l=function(e){var t=e.match.params.data_element_id,n=e.dataElements;return"new"===t||t>=(n||Object(E.List)()).size}(this.props)?n:a;return this.setState({waitingForExtensionResponse:!0}),r.promise.then(function(e){return Promise.all([e.validate(),e.getSettings()])}).then(function(t){var n=Object(C.a)(t,2),a=n[0],r=n[1];a?(l({id:s.data_element_id,dataElement:i.merge({settings:r})}),o.push(e.constructor.backLink())):e.setState({waitingForExtensionResponse:!1})}),!0}},{key:"dataElementsList",value:function(){var e={},t=[];return(this.props.registry.getIn(["components","dataElements"])||Object(E.List)()).valueSeq().forEach(function(t){e[t.get("extensionDisplayName")]||(e[t.get("extensionDisplayName")]=[]),e[t.get("extensionDisplayName")].push(r.a.createElement("option",{value:"".concat(t.get("extensionName"),"/").concat(t.get("libPath")),key:"optionType".concat(t.get("libPath"))},t.get("displayName")))}),Object.keys(e).forEach(function(n){t.push(r.a.createElement("optgroup",{key:"optGroupExtension".concat(n),label:n},e[n]))}),t}},{key:"isValid",value:function(){var e={},t=this.state.dataElement,n=this.props.currentIframe;return t.get("name")||(e.name=!0),t.get("modulePath")&&n.promise||(e.modulePath=!0),this.setState({errors:e}),0===Object.keys(e).length}},{key:"render",value:function(){var e=this.props,t=e.registry,n=e.extensionConfigurations,a=this.state,o=a.waitingForExtensionResponse,s=a.errors,i=a.dataElement,l=t.getIn(["components","dataElements",i.get("modulePath")]),c=i.get("modulePath").split("/")[0];return r.a.createElement("div",{className:"pure-g component-edit-container"},o?r.a.createElement(le,{message:"Waiting for the extension response..."}):null,r.a.createElement("div",{className:"pure-u-1-4"},r.a.createElement("div",{className:"component-edit-sidebar"},r.a.createElement("form",{className:"pure-form pure-form-stacked"},r.a.createElement("fieldset",null,r.a.createElement("h4",null,"Data Element Details"),r.a.createElement("label",{htmlFor:"dataElementName"},r.a.createElement("span",null,"Name"),r.a.createElement("input",{className:s.name?"border-error":"",id:"dataElementName",type:"text",value:i.get("name")||"",onChange:this.handleInputChange.bind(this,"name")})),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"dataElementType"},r.a.createElement("span",null,"Type"),r.a.createElement("select",{id:"dataElementType",className:s.modulePath?"border-error":"",value:i.get("modulePath"),onChange:this.handleComponentTypeChange.bind(this)},r.a.createElement("option",{value:""},"Please select..."),this.dataElementsList())),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"defaultValue"},r.a.createElement("span",null,"Default Value"),r.a.createElement("input",{id:"defaultValue",type:"text",value:i.get("defaultValue")||"",onChange:this.handleInputChange.bind(this,"defaultValue")})),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"forceLowerCase",className:"pure-checkbox"},r.a.createElement("input",{id:"forceLowerCase",type:"checkbox",checked:i.get("forceLowerCase")||"",onChange:this.handleInputChange.bind(this,"forceLowerCase")})," ","Force lower case"),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"cleanText",className:"pure-checkbox"},r.a.createElement("input",{id:"cleanText",type:"checkbox",checked:i.get("cleanText")||"",onChange:this.handleInputChange.bind(this,"cleanText")})," ","Clean Text"),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"storageDuration"},r.a.createElement("span",null,"Storage duration"),r.a.createElement("select",{id:"storageDuration",value:i.get("storageDuration")||"",onChange:this.handleInputChange.bind(this,"storageDuration")},r.a.createElement("option",{value:""}," None "),r.a.createElement("option",{value:"pageview"}," Pageview "),r.a.createElement("option",{value:"session"}," Session "),r.a.createElement("option",{value:"visitor"}," Visitor "))))),r.a.createElement("div",{className:"button-container"},r.a.createElement("button",{type:"button",className:"pure-button-primary pure-button",onClick:this.handleSave.bind(this)},"Save"),"\xa0",r.a.createElement(p.Link,{to:this.constructor.backLink(),className:"pure-button"},"Cancel")))),r.a.createElement("div",{className:"pure-u-3-4"},r.a.createElement(ie,{component:l,extensionConfiguration:n.filter(function(e){return e.get("name")===c}).first(),settings:i.get("settings"),server:t.getIn(["environment","server"])})))}}]),t}(a.Component),Ee=Object(g.k)(Object(d.b)(function(e){return{dataElements:e.dataElements,currentIframe:e.currentIframe,registry:e.registry,extensionConfigurations:e.extensionConfigurations}},function(e){var t=e.dataElements,n=t.saveDataElement,a=t.addDataElement;return{saveDataElement:function(e){return n(e)},addDataElement:function(e){return a(e)}}})(fe)),ve=Object(g.k)(Object(d.b)(function(e){return{extensionConfigurations:e.extensionConfigurations}},function(e){var t=e.extensionConfigurations.deleteExtensionConfiguration;return{deleteExtensionConfiguration:function(e){return t(e)}}})(function(e){var t=e.extensionConfigurations,n=e.deleteExtensionConfiguration;return r.a.createElement(Q,{items:t,nameProperty:"displayName",deleteFn:n,linkPrefix:"/extension_configurations",className:"extension-configurations-list"})})),be=function(e){var t=e.extensionConfigurations,n=e.match.params.extension_configuration_id;return"new"===n||n>=(t||Object(E.List)()).size},ye=function(e){var t=e.extensionConfigurations,n=e.match.params.extension_configuration_id;return(t||Object(E.List)()).get(n)||Object(E.Map)({name:"",settings:null})},Ce=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleNameChange=function(e){var t=n.state.extensionConfiguration;n.setState({extensionConfiguration:t.merge({settings:null,name:e.target.value})})},n.handleSave=function(){if(!n.isValid())return!1;var e=n.props,t=e.addExtensionConfiguration,a=e.saveExtensionConfiguration,r=e.currentIframe,o=e.history,s=e.registry,i=e.match.params,l=n.state.extensionConfiguration,c=be(n.props)?t:a,u=s.getIn(["extensions",l.get("name"),"displayName"]);return n.setState({waitingForExtensionResponse:!0}),r.promise.then(function(e){return Promise.all([e.validate(),e.getSettings()])}).then(function(e){var t=Object(C.a)(e,2),a=t[0],r=t[1];a?(c({id:i.extension_configuration_id,extensionConfiguration:l.merge({displayName:u,settings:r})}),o.push(n.constructor.backLink())):n.setState({waitingForExtensionResponse:!1})}),!0},n.state={waitingForExtensionResponse:!1,extensionConfiguration:ye(e),errors:{}},n}return Object(m.a)(t,e),Object(l.a)(t,null,[{key:"backLink",value:function(){return"/extension_configurations/"}}]),Object(l.a)(t,[{key:"extensionConfigurationList",value:function(){return(this.props.registry.get("extensions")||Object(E.List)()).filter(function(e){return e.get("viewPath")}).valueSeq().map(function(e){return r.a.createElement("option",{value:e.get("name"),key:"extensionConfiguration".concat(e.get("name"))},e.get("displayName"))})}},{key:"isValid",value:function(){var e={};return this.state.extensionConfiguration.get("name")||(e.name=!0),this.setState({errors:e}),0===Object.keys(e).length}},{key:"render",value:function(){var e=this.props.registry,t=this.state,n=t.errors,a=t.extensionConfiguration,o=t.waitingForExtensionResponse,s=e.getIn(["extensions",a.get("name")]);return r.a.createElement("div",{className:"pure-g component-edit-container"},o?r.a.createElement(le,{message:"Waiting for the extension response..."}):null,r.a.createElement("div",{className:"pure-u-1-4"},r.a.createElement("div",{className:"component-edit-sidebar"},r.a.createElement("form",{className:"pure-form pure-form-stacked"},r.a.createElement("fieldset",null,r.a.createElement("h4",null,"Extension Configuration Name"),r.a.createElement("label",{htmlFor:"extensionConfigurationName"},r.a.createElement("span",null,"Name"),r.a.createElement("select",{id:"extensionConfigurationName",className:n.name?"border-error":"",value:a.get("name"),onChange:this.handleNameChange},r.a.createElement("option",{value:""},"Please select..."),this.extensionConfigurationList())))),r.a.createElement("div",{className:"button-container"},r.a.createElement("button",{type:"button",className:"pure-button-primary pure-button",onClick:this.handleSave},"Save"),"\xa0",r.a.createElement(p.Link,{to:this.constructor.backLink(),className:"pure-button"},"Cancel")))),r.a.createElement("div",{className:"pure-u-3-4"},r.a.createElement(ie,{component:s,settings:a.get("settings"),server:e.getIn(["environment","server"])})))}}]),t}(a.Component),Se=Object(g.k)(Object(d.b)(function(e){return{extensionConfigurations:e.extensionConfigurations,currentIframe:e.currentIframe,registry:e.registry}},function(e){var t=e.extensionConfigurations,n=t.saveExtensionConfiguration,a=t.addExtensionConfiguration;return{saveExtensionConfiguration:function(e){return n(e)},addExtensionConfiguration:function(e){return a(e)}}})(Ce));P({type:"brain/initialize"});var ke=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(d.a,{store:w},r.a.createElement(p.HashRouter,null,r.a.createElement(h.LastLocationProvider,null,r.a.createElement(g.g,null,r.a.createElement(q,{exact:!0,path:"/",component:W}),r.a.createElement(q,{exact:!0,path:"/settings",component:H}),r.a.createElement(q,{exact:!0,path:"/property_settings",component:K}),r.a.createElement(q,{exact:!0,path:"/rules",component:X}),r.a.createElement(q,{exact:!0,path:"/rules/:rule_id",component:re}),r.a.createElement(q,{exact:!0,path:"/rules/:rule_id/:type(events|conditions|actions)/:component_id",component:pe}),r.a.createElement(q,{exact:!0,path:"/data_elements",component:ge}),r.a.createElement(q,{exact:!0,path:"/data_elements/:data_element_id",component:Ee}),r.a.createElement(q,{exact:!0,path:"/extension_configurations",component:ve}),r.a.createElement(q,{exact:!0,path:"/extension_configurations/:extension_configuration_id",component:Se})))))}}]),t}(a.Component);s.a.render(r.a.createElement(ke,null),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.d251c792.chunk.js.map